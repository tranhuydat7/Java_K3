-- I 
-- Câu 1:Liệt kê MaDatPhong, MaDV, SoLuong của tất cả các dịch vụ có số lượng lớn hơn 3 và nhỏ hơn 10. (1
select dat.MADATPHONG, MADV, SOLUONG 
FROM dat_phong dat 
join chi_tiet_su_dung_dv chi 
on dat.MADATPHONG = chi.MADATPHONG
where SOLUONG between 3 and 10;
-- Câu 2: Cập nhật dữ liệu trên trường GiaPhong thuộc bảng PHONG tăng lên 10,000 VNĐ so với giá phòng hiện tại, chỉ cập nhật giá phòng của  những phòng có số khách tối đa lớn hơn 10. (1
Update phong set GIAPHONG = GIAPHONG+10 where SOKHACHTOIDA >10;
-- Câu 3: Xóa tất cả những đơn đặt phòng (từ bảng DAT_PHONG) có trạng thái đặt (TrangThaiDat) là “Da huy”.
delete from dat_phong where TRANGTHAIDAT = "DA HUY";
SET FOREIGN_KEY_CHECKS=0; 
-- cau 4: Câu 4: Hiển thị TenKH của những khách hàng có tên bắt đầu là một trong các ký tự “H”, “N”, “M” và có độ dài tối đa là 20 ký tự.
select TENKH from khach_hang 
where (TENKH like 'H%' or TENKH like 'N%' or TENKH like 'M%') and length(TENKH) <= 20;
-- cau 5. Câu 5: Hiển thị TenKH của tất cả các khách hàng có trong hệ thống, TenKH nào trùng nhau thì chỉ hiển thị một lần. Sinh viên sử dụng hai cách khác nhau đ thực hiện yêu cầu trên, mỗi cách sẽ được 0,5 điểm.
-- cach 1;
select TENKH from khach_hang
union
select TENKH from khach_hang;
-- cach 2: 
select distinct TENKH from khach_hang;
-- Câu 6: Hiển thị MaDV, TenDV, DonViTinh, DonGia của những dịch vụ đi kèm có DonViTinh là “lon” và có DonGia lớn hơn 10,000 VNĐ hoặc những dịch vụ đi kèm có DonViTinh là “Cai” và có DonGia nhỏ hơn 5,000 VNĐ. (1 điểm)
select MADV, TENDV, DONVITINH, DONGIA 
from dich_vu_di_kem
where (DONVITINH = 'LON' and  DONGIA > 10000)
or (DONVITINH = 'CAI' and DONGIA < 5000);
-- Câu 7: Hiển thị MaDatPhong, MaPhong, LoaiPhong, SoKhachToiDa, GiaPhong, MaKH, TenKH, SoDT, NgayDat, GioBatDau, GioKetThuc, MaDichVu, SoLuong, DonGia của những đơn đặt phòng có năm đặt phòng là “2016”, “2017” và đặt những phòng có giá phòng &gt; 50,000 VNĐ/ 1 giờ. (1 điểm)
select d.MAPHONG, LOAIPHONG, SOKHACHTOIDA, GIAPHONG, k.MAKH, TENKH, SODT, NGAYDAT, GIOBATDAU, GIOKETTHUC, dv.MADV, SOLUONG, DONGIA
from dat_phong d 
join khach_hang k on d.MAKH = k.MAKH
join phong p on d.MAPHONG = p.MAPHONG
join chi_tiet_su_dung_dv c on d.MADATPHONG = c.MADATPHONG
join dich_vu_di_kem dv on dv.MADV = c.MADV
where (year(NGAYDAT) = '2016' or year(NGAYDAT) = '2018') and GIAPHONG > 50000;
-- Câu 8: Hiển thị MaDatPhong, MaPhong, LoaiPhong, GiaPhong, TenKH, NgayDat, TongTienHat, TongTienSuDungDichVu, TongTienThanhToan tương ứng với từng mã đặt phòng có trong bảng DAT_PHONG. Những đơn đặt phòng nào không sử dụng dịch vụ đi kèm thì cũng liệt kê thông tin của đơn đặt phòng đó ra. (1 điểm)
select d.MADATPHONG, d.MAPHONG, LOAIPHONG, GIAPHONG, TENKH, NGAYDAT, GIAPHONG*(GIOKETTHUC-GIOBATDAU) as TONGTIENHAT, (SOLUONG*DONGIA) as TONGTIENSUDUNGDV, ((GIAPHONG*(GIOKETTHUC-GIOBATDAU))+SUM((SOLUONG*DONGIA))) as TONGTIENTHANHTOAN
from dat_phong d 
join khach_hang k on d.MAKH = k.MAKH
join phong p on d.MAPHONG = p.MAPHONG
left join chi_tiet_su_dung_dv c on c.MADATPHONG = d.MADATPHONG
left join dich_vu_di_kem dv on dv.MADV = c.MADV
group by d.MADATPHONG;
-- Câu 9: Hiển thị MaKH, TenKH, DiaChi, SoDT của những khách hàng đã từng đặt phòng karaoke có địa chỉ ở “Hoa xuan”. (1 điểm)
select MAKH, TENKH, DIACHI, SODT from khach_hang where DIACHI = 'Hoa Xuan';
-- cau 10: Câu 10: Hiển thị MaPhong, LoaiPhong, SoKhachToiDa, GiaPhong, SoLanDat của những phòng được khách hàng đặt có số lần đặt lớn hơn 2 lần và trạng thái đặt là “Da dat”. (1 điểm)
select p.MAPHONG, LOAIPHONG, SOKHACHTOIDA, GIAPHONG, count(d.MAPHONG) as tong
from dat_phong d
join phong p on p.MAPHONG = d.MAPHONG
where TRANGTHAIDAT = 'DA DAT' having tong > 2